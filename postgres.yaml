kind: volumeset
name: nuatobot-postgres-storage
description: nautobot-postgres-storage
spec:
  fileSystemType: ext4
  initialCapacity: 10
  performanceClass: general-purpose-ssd
  autoscaling:
    maxCapacity: 100
    minFreePercentage: 1
    scalingFactor: 1.1
---
kind: workload
name: nautobot-db
description: postgres db for nautobot
spec:
  type: stateful
  # identityLink: //gvc/YOUR-GVC/identity/nautobot-identity
  containers:
    - name: postgres
      image: docker.io/postgres:17-alpine
      cpu: 150m
      memory: 256Mi
      inheritEnv: true
      volumes:
        - path: /var/lib/postgresql/data
          uri: cpln://volumeset/nuatobot-postgres-storage
          recoveryPolicy: retain
      ports:
        - number: 5432
          protocol: tcp
      env:
        - name: POSTGRES_USER
          value: nautobot
        - name: POSTGRES_PASSWORD
          value: nautobot
        - name: POSTGRES_DB
          value: nautobot
        - name: PGDATA
          value: /var/lib/postgresql/data/pgdata
      readinessProbe:
        exec:
          command:
            - /bin/sh
            - '-c'
            - 'pg_isready -h localhost -U nautobot -d nautobot'
        failureThreshold: 10
        periodSeconds: 10
        timeoutSeconds: 5 
  defaultOptions:
    autoscaling:
      maxConcurrency: 0
      maxScale: 1
      metric: disabled
      minScale: 1
      scaleToZeroDelay: 300
      target: 1
    capacityAI: false
    debug: false
    suspend: false
    timeoutSeconds: 5
  firewallConfig:
    external:
      inboundAllowCIDR: []
      outboundAllowCIDR: []
    internal:
      inboundAllowType: same-gvc
      inboundAllowWorkload: []
